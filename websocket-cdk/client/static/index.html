<!DOCTYPE html>
<html>
  <style> html, input {font-family: courier,arial,helvetica;} </style>
  <script>
    let URL = 'wss://qx1oamgzzl.execute-api.us-east-1.amazonaws.com/prod';
    let wsocket = null;
    let update_msg = function(msg) { document.getElementById('divMsg').innerHTML = msg; };
    
    let socket_connect = function() {
      update_msg(`Trying to connect the websocket`);
      let socket = new WebSocket(URL);

      socket.onopen = function (event) {
        update_msg(`Websocket is connected`);
        socket.onmessage = function (event) { update_msg(event.data); }
      };

      return socket;
    }

    let add_autorefresh = function() {
      let url = 'http://localhost:3000/refresh-script';

      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        
        if (this.readyState == 4 && this.status == 200) {
          let script_url = (this.responseText || '').trim();
          
          if (script_url) {
            let script = document.createElement('script');
            script.setAttribute('src', script_url);
            document.head.appendChild(script);
          }
        }
      };

      xhttp.open("GET", url, true);
      xhttp.send();
    };

    let wnd_onload = function(e) { wsocket = socket_connect(); add_autorefresh(); };

    let send_onclick = function() {
      let element = document.getElementById('txtInput');

      let txt = element.value.trim();
      let msg = { action: 'sendmessage', data: txt };

      wsocket.send(JSON.stringify(msg));
      element.value = '';
    };

    let txtInput_onkeyup = function(e) { if (e.keyCode == 13) { send_onclick(); } };

  </script>

  <body onload="return wnd_onload(event)">

    <div>
      <input id="txtInput" type="text" onkeyup="return txtInput_onkeyup(event)" />
      <button onclick="return send_onclick()">Send</button>
    </div>
    <br />
    <div id="divMsg"></div>
    <div>Never mind</div>
  </body>
</html>